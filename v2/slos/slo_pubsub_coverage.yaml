---
apiVersion: cloud.google.com/v1
kind: ServiceLevelObjective
metadata:
  name: generator-pubsub-ack
  labels:
    service_name: generator
    feature_name: pubsub
    slo_name: coverage
    team_name: app-team-1
    env: dev
spec:
  description: 99% of outstanding PubSub messages are acknowledged
  goal: 0.99
  backend: cloud_monitoring
  exporters: [pubsub, cloud_monitoring]
  method: good_bad_ratio
  serviceLevelIndicator:
    filter_good: >
      project="${project_id}"
      metric.type="pubsub.googleapis.com/subscription/ack_message_count"
      resource.type="pubsub_subscription"
    filter_bad:  >
      project="${project_id}"
      metric.type="pubsub.googleapis.com/subscription/num_undelivered_messages"
      resource.type="pubsub_subscription"
